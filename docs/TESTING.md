# 文颜-rev 测试指南 (Testing Guide)

本文档描述了 **文颜-rev** 的测试流程与回归检查清单。

## 当前测试现状

*   **自动化测试**: 暂无。项目中虽然包含了 `Playwright` 依赖，但尚未进行配置。
*   **测试脚本**: `package.json` 中没有 `npm test` 指令。
*   **测试目录**: 暂无 `test/` 或 `tests/` 目录。
*   **主要方式**: 目前完全依赖于人工手动回归测试。

---

## 1. 冒烟测试 (Smoke Test)

冒烟测试的目标是在每次构建或重大更改后，快速验证应用程序的核心功能是否可用。

- [ ] **启动验证**: 运行 `npm run tauri-dev`，应用应能正常启动且不报错。
- [ ] **内容加载**: 首次启动或无缓存启动时，应自动加载项目 `README.md` 内容。
- [ ] **实时同步**: 在左侧编辑器输入文字，右侧预览区应实时更新。
- [ ] **基本复制**: 点击右下角“复制”按钮，剪贴板应包含格式化后的 HTML 内容。
- [ ] **退出与恢复**: 关闭并重新打开应用，上次编辑的内容应被保留。

---

## 2. 全量回归测试清单 (Full Regression Checklist)

在发布新版本之前，必须按照以下清单逐一执行测试，确保没有功能退化。

### 2.1 启动与基础交互
- [ ] **默认内容**: 资源文件中的 `README.md` 能够正确加载并在编辑器中显示。
- [ ] **双向滚动同步**:
    - [ ] 滚动编辑器，预览区应同步滚动。
    - [ ] 滚动预览区，编辑器应同步滚动。
- [ ] **预览模式切换**:
    - [ ] 切换至“移动端预览”，预览区宽度应缩小为手机尺寸。
    - [ ] 切换回“桌面端预览”，预览区应恢复宽度。

### 2.2 平台与主题系统
- [ ] **平台切换**: 点击顶部工具栏的平台图标（微信、知乎、掘金等），预览样式应实时变化。
- [ ] **内置主题**: 在微信平台下，打开“主题”菜单，选择不同的内置主题（如 Orange Heart, Rainbow），预览效果应正确应用。
- [ ] **自定义主题 (CRUD)**:
    - [ ] **新建**: 点击“+”号可打开 CSS 编辑器，保存后新主题出现在列表中。
    - [ ] **重命名**: 双击主题名称可进入编辑模式，修改后按回车保存。
    - [ ] **编辑**: 点击主题旁的编辑图标，可重新编辑 CSS 代码。
    - [ ] **应用**: 选中自定义主题，预览区应应用对应的 CSS。
- [ ] **代码高亮主题**: 在主题菜单中切换不同的高亮风格（GitHub, Monokai, Atom Dark 等），代码块颜色应变化。
- [ ] **字体选择器**:
    - [ ] 切换“跟随主题”、“衬线字体”和“无衬线字体”，预览区文字应变化。
    - [ ] 确认代码块字体始终保持为 `JetBrains Mono`。

### 2.3 功能开关 (Toggles)
- [ ] **脚注功能 (Footnotes)**:
    - [ ] 开启脚注：链接后应出现序号，文末应生成引用链接列表。
    - [ ] **防重复检查**: 多次点击开关或在开启状态下编辑内容，不应出现序号重复叠加（如 `[1][1]`）。
    - [ ] **持久化**: 开启脚注后，修改编辑器内容，脚注应保持显示。
- [ ] **图例功能 (Captions)**:
    - [ ] 开启图例：Markdown 图片的 `alt` 文本应显示在图片下方作为标题。
    - [ ] **渲染逻辑**: 图例通过 `refreshContentWithFont` 重新渲染，不应破坏现有的字体设置。
    - [ ] **功能协同**: 同时开启脚注和图例，两者应互不冲突（图例重新渲染时不能丢失脚注）。

### 2.4 文件操作
- [ ] **打开文件**: 通过菜单“打开文件...”选择本地 `.md` 文件，内容应正确载入。
- [ ] **拖拽支持**: 将本地 `.md` 文件拖入应用窗口，内容应正确载入。

### 2.5 发布与导出
- [ ] **复制流程**:
    - [ ] 测试每个平台（微信、知乎、掘金、Medium、今日头条）的复制功能。
    - [ ] 将内容粘贴到对应平台的编辑器中，确认样式（颜色、间距、代码块、脚注、任务列表）基本一致。
- [ ] **长图导出 (仅微信平台)**:
    - [ ] 点击“长图”按钮，应弹出保存对话框。
    - [ ] 生成的图片应包含完整的预览区内容，且布局无错位。

### 2.6 状态持久化 (Persistence)
- [ ] **配置保存**: 修改平台设置、主题选择、字体设置、功能开关（脚注/图例）后，重启应用。
- [ ] **预期结果**: 所有设置应恢复到关闭前的状态，无需用户重新配置。

---

## 3. 常见问题排查 (Troubleshooting)

*   **预览区空白**: 检查 Markdown 语法是否有误（特别是数学公式或复杂的 HTML 标签）。
*   **自定义主题失效**: 确保 CSS 选择器包含了 `#wenyan` 前缀。
*   **复制到微信格式混乱**: 微信编辑器对某些 CSS 属性有限制，请优先使用内置主题作为参考。

---

*上次更新日期: 2026-01-21*
